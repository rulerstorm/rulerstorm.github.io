<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Unity3d使用SqLite的坑 · Rock's personal notebook</title><meta name="description" content="Unity3d使用SqLite的坑 - Rock Lu"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/u/1565858217" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/rulerstorm" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li><li class="nav-list-item"><a href="/impress/index.html" target="_self" class="nav-list-link">TEST</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">Unity3d使用SqLite的坑</h1><div class="post-time">Sep 23, 2015</div><div class="post-content"><p>SqLite作为轻量级C语言本地数据库，一直是挺讨我喜欢。这次实验室的Unity项目需要本地数据库，就研究了下怎么在Unity3D中集成sqlite。想不到坑那么多，各种坑，也是醉了。</p>
<a id="more"></a>
<p>步骤如下：</p>
<ol>
<li>Create new folder under Assets Folder Rename it <code>Plugins</code>.</li>
<li>Copy <code>sqlite3.def</code> and sqlite3.dll into <code>Assets/Plugins</code> in your unity project .You can download these files here <code>http://www.sqlite.org/download.html</code> for windows (Precompiled Binaries for Windows)</li>
<li>Download SQLite Browser <code>https://github.com/sqlitebrowser/sqlitebrowser</code>（GUI数据库编辑器）</li>
<li>Create Database in <code>Assets</code> folder in your unity project using SQLite Browser.（必须先手动创建好）</li>
<li>Copy <code>System.Data.dll</code> and <code>Mono.Data.Sqlite.dll</code> from <code>C:\Program Files (x86)\Unity \Editor\Data\Mono\lib\mono\2.0*</code> and paste them in your <code>Assets/Plugins*</code> folder in your unity project.</li>
<li>Add these namespaces <code>using Mono.Data.Sqlite; using System.Data; using System;</code></li>
</ol>
<p>然后，可以写一个helper类，unity里面可以自动引用。核心代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">string dbName =  &quot;/testDatabase.db&quot;;   //注意这里很容易出错，小心别漏了/号</div><div class="line">string tableName = &quot;testTable&quot;;</div><div class="line"></div><div class="line">//开始建立连接</div><div class="line">string conn = &quot;URI=file:&quot; + Application.dataPath + dbName; //Path to database.         IDbConnection dbconn;</div><div class="line">dbconn = (IDbConnection)new SqliteConnection(conn);</div><div class="line">dbconn.Open(); //Open connection to the database.</div><div class="line"></div><div class="line">//准备查询语句</div><div class="line">IDbCommand dbcmd = dbconn.CreateCommand();</div><div class="line">string sqlQuery = &quot;SELECT * FROM &quot; + tableName;</div><div class="line">dbcmd.CommandText = sqlQuery;</div><div class="line">//执行语句</div><div class="line">IDataReader reader = dbcmd.ExecuteReader();</div><div class="line"></div><div class="line"></div><div class="line">//下面开始处理返回数据</div><div class="line">while (reader.Read())</div><div class="line">&#123;</div><div class="line">    int ID = reader.GetInt32(0);      //返回一个数组，下标0则第一个字段</div><div class="line">    string text = reader.GetString(1) + &apos;\n&apos;;   //第二个字段</div><div class="line">    Debug.Log(&quot;ID= &quot; + ID + &quot;  name =&quot; + name);</div><div class="line">&#125;</div><div class="line"></div><div class="line">//下面开始关闭连接</div><div class="line">reader.Close();</div><div class="line">reader = null;</div><div class="line">dbcmd.Dispose();</div><div class="line">dbcmd = null;</div><div class="line">dbconn.Close();</div><div class="line">dbconn = null;</div></pre></td></tr></table></figure>
<h5 id="坑在哪里？"><a href="#坑在哪里？" class="headerlink" title="坑在哪里？"></a>坑在哪里？</h5><p>这样子在编辑器里面就OK了，可是！不能编译。。。醉了，查了一下，需要调整Unity项目的设置，如下：<br><code>PlayerSetting -&gt; Other Settings -&gt; Optimization -&gt; Api Compatibility Level</code>这个下拉菜单，手动选择为：<code>.NET 2.0</code>。<br>于是我们终于可以编译了。</p>
<h5 id="别高兴太早，编译好之后的程序访问不了数据库。。。。"><a href="#别高兴太早，编译好之后的程序访问不了数据库。。。。" class="headerlink" title="别高兴太早，编译好之后的程序访问不了数据库。。。。"></a>别高兴太早，编译好之后的程序访问不了数据库。。。。</h5><p>经过长时间的反复排查，最后打印了db的路径，终于发现。。。编译的时候没有把数据库复制过去。。。需要<code>手动</code>把数据库复制到各个平台的运行文件中。<br>具体路径可打印<code>Application.dataPath</code>获得。</p>
<p>真不容易。。。</p>
</div></article></div></section><footer><div class="paginator"><a href="/2015/10/14/iOS9更新后的坑/" class="prev">上一篇</a><a href="/2015/09/09/读现代操作系统/" class="next">下一篇</a></div><div class="copyright"><p>© 2015 - 2017 <a href="http://Rocklu.me">Rock Lu</a>, unless otherwise noted.</p></div></footer><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script></body></html>
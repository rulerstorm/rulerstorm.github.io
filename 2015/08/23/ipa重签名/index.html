<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> ipa重签名 · Rock's personal notebook</title><meta name="description" content="ipa重签名 - Rock Lu"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/u/1565858217" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/rulerstorm" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li><li class="nav-list-item"><a href="/impress/index.html" target="_self" class="nav-list-link">TEST</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">ipa重签名</h1><div class="post-time">Aug 23, 2015</div><div class="post-content"><p>缘由是朋友问我淘宝上买的「双开微信」是不是安全，我就去研究了下bundle改签名的原理。本来以为不就是改个签名嘛，想不到坑很大。</p>
<a id="more"></a>
<h4 id="方法一：手动用codesign命令："><a href="#方法一：手动用codesign命令：" class="headerlink" title="方法一：手动用codesign命令："></a>方法一：手动用<code>codesign</code>命令：</h4><p>这条命令是mac电脑默认自带的，格式如下：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">codesign -fs <span class="string">"iPhone Distribution: Le Lu (99ZNA7BG5M)"</span> --entitlements ~<span class="regexp">/Desktop/</span>entitlements.plist ~<span class="regexp">/.../</span>Pastebot1.<span class="number">4.2</span><span class="regexp">/Payload/</span>Pastebot.app</div></pre></td></tr></table></figure>
<p>这条命令可以覆盖原来的签名。</p>
<p>「注意1」<br><code>iPhone Distribution: Le Lu (99ZNA7BG5M)</code>是证书的名字，可在钥匙串工具里面找到证书，然后看里面的<code>commom name</code>栏目<br>「注意2」<br>这里需要自己制作一个plist文件，命名为<code>entitlements.plist</code>，文本如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span><span class="meta">?&gt;</span></span></div><div class="line"><span class="meta">&lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">plist</span> <span class="attr">version</span>=<span class="string">"1.0"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">dict</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">key</span>&gt;</span>application-identifier<span class="tag">&lt;/<span class="name">key</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">string</span>&gt;</span>SXY7J8MS3P.me.rocklule.test<span class="tag">&lt;/<span class="name">string</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">key</span>&gt;</span>com.apple.developer.team-identifier<span class="tag">&lt;/<span class="name">key</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">string</span>&gt;</span>SXY7J8MS3P<span class="tag">&lt;/<span class="name">string</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">key</span>&gt;</span>get-task-allow<span class="tag">&lt;/<span class="name">key</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">false</span>/&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">key</span>&gt;</span>keychain-access-groups<span class="tag">&lt;/<span class="name">key</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">array</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">string</span>&gt;</span>SXY7J8MS3P.me.rocklule.test<span class="tag">&lt;/<span class="name">string</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">array</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dict</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">plist</span>&gt;</span></div></pre></td></tr></table></figure>
<p>其中：<code>SXY7J8MS3P.me.rocklule.test</code>是需要改动的，前面的<code>SXY7J8MS3P</code>是开发者前缀，可以在钥匙串工具里的证书说明里面查到，后面是包名，注意所有这本的包名要一致。<br>「坑1」：这个文件前面不可以有空格，有了就不行。<br>「坑2」：网上这个文件版本有两种，另一种不好使。。。</p>
<p>第二步是把<code>xx.mobileprovision</code>改名为<code>embedded.mobileprovision</code>放到app目录下。<br>「坑1」名字不可改。<br>「坑2」这个文件有不同的发布版本，<code>必须</code>是<code>app store</code>方式。</p>
<p>完成后用zip命令打包：<br><code>zip -r xxxx.ipa SORCE_DIER</code></p>
<h4 id="方法二：用iReSign软件"><a href="#方法二：用iReSign软件" class="headerlink" title="方法二：用iReSign软件"></a>方法二：用<code>iReSign</code>软件</h4><p>这个软件在github有链接，直接下载下来用就可以。会自动帮你提取证书的commom name，比较方便。</p>
<h4 id="最大的坑"><a href="#最大的坑" class="headerlink" title="最大的坑"></a>最大的坑</h4><p>必须要<code>企业证书</code>重签名的app才能安装，个人证书签完了闪退。。。</p>
</div></article></div></section><footer><div class="paginator"><a href="/2015/08/25/git的push方式/" class="prev">PRVE</a><a href="/2015/07/09/JS_CheatSheet/" class="next">NEXT</a></div><div class="copyright"><p>© 2015 - 2016 <a href="http://Rocklu.me">Rock Lu</a>, unless otherwise noted.</p></div></footer><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script></body></html>
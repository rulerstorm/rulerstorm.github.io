<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> IOS开发笔记 · Rock's personal notebook</title><meta name="description" content="IOS开发笔记 - Rock Lu"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/u/1565858217" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/rulerstorm" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li><li class="nav-list-item"><a href="/impress/index.html" target="_self" class="nav-list-link">TEST</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">IOS开发笔记</h1><div class="post-time">May 27, 2015</div><div class="post-content"><p>IOS开发已经搞了两个月，积累了一些经验。详实记录，以供查阅。</p>
<a id="more"></a>
<h4 id="调用OC的代码"><a href="#调用OC的代码" class="headerlink" title="调用OC的代码"></a>调用OC的代码</h4><ol>
<li>需要建立一个<code>bridging-header.h</code>（本来好像会自动建立，现在需要手动建立了，名字无所谓）</li>
<li>在项目的<code>Build Settings</code>里面搜索swift，可以看到<code>Swift Compiler - Code Generation</code>大栏目，里面有<code>Objective-C Bridging Header</code>，把刚刚建立的头文件名字放进去就ok</li>
<li>然后，所有的oc头文件只要包含在这个桥文件里面，就自动在所有的swift文件里面可以使用了。</li>
</ol>
<hr>
<h4 id="如何创建一个View"><a href="#如何创建一个View" class="headerlink" title="如何创建一个View"></a>如何创建一个View</h4><p>总体来说，如果这个View只管展示，不需要交互，可以直接创建一个裸的UIView。否则就创建一个UIViewController，会自带一个View。</p>
<p><strong>方法一：通过storyBoard</strong></p>
<ol>
<li>有入口箭头的Controller会默认加载，如果找不到箭头了，请在controller属性里面找<code>Is Initial View Controller</code>把它勾上</li>
<li>对于segue指向的controller也是会自动加载</li>
<li>对于无法用segue连线的单独controller也可以放在storyboard中，此时先通过代码加载storyboard，然后通过唯一的<code>Storyboard ID</code>加载这个controller。<br>示例代码：<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> storyBoard = <span class="type">UIStoryboard</span>(name: <span class="string">"Main"</span>, bundle: <span class="literal">nil</span>)    <span class="comment">//先加载storyboard对象</span></div><div class="line"><span class="keyword">let</span> chat = storyBoard.instantiateViewControllerWithIdentifier(<span class="string">"inquiry"</span>) <span class="keyword">as</span>! <span class="type">InquiryChatTableViewController</span>    <span class="comment">//再加载controller</span></div></pre></td></tr></table></figure>
</li>
</ol>
<p><strong>方法二：通过xib</strong><br>类似于从storyBoard，优点是多个view可以放在单独的文件里，归类。<br>示例代码：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> nib = <span class="type">UINib</span>(nibName: <span class="string">"TabBarView"</span>, bundle: <span class="literal">nil</span>)  <span class="comment">//记得设置xib控件里面的class</span></div><div class="line"><span class="keyword">let</span> newTabBar = nib.instantiateWithOwner(<span class="literal">nil</span>, options: <span class="literal">nil</span>)[<span class="number">0</span>] <span class="keyword">as</span>! <span class="type">MyTabBar</span>  <span class="comment">//注意实例化后返回的是数组</span></div></pre></td></tr></table></figure>
<p><strong>方法三：通过代码new</strong><br>我碰到大概有这几种情况需要自己new</p>
<ol>
<li>界面布局需要动态计算</li>
<li>需要一次性循环生成多个view</li>
<li>布局太简单没有什么子控件</li>
</ol>
<hr>
<h4 id="自定义控件的若干经验"><a href="#自定义控件的若干经验" class="headerlink" title="自定义控件的若干经验"></a>自定义控件的若干经验</h4><ol>
<li>基本思路是创建一个新类继承自默认类，然后对需要改动的方法进行override。</li>
<li>自定义的view如果需要交互，一般设置一个委托delegate属性，配套一个协议protocol定义好调用的函数，然后把外部的controller设置为它的委托，让view持有引用（weak）。事件发生时，view通过调用委托在协议中定义好的方法把事件传递给外部的controller。</li>
<li>自定义控件如果布局复杂，通常会搞一个xib，把控件的class设置为自定义的view。</li>
<li>从xib连线到view的<code>@IBOutlet</code>什么时候生效？ 这个需要详细查询view的生命周期，总之记住，在init()里面它们还为被设置，此时这些@IBOutlet的属性还均是nil。一个比较合适的方法是用swift的新功能<code>didSet</code>，在didset里面对这些属性进行配置。</li>
<li>对于需要用代码创建的子控件，可以放在init函数里面。此时处理事件就要<code>addTarget</code></li>
<li>如果你的控件看不见……检查下以下方面：1，frame，2，是否加入主view的subView，3，alpha</li>
<li>当控件的frame变化时，会调用<code>layoutSubviews</code>，所以在这里面设置subView的frame最合适。</li>
</ol>
<hr>
<h4 id="关于启动页图片"><a href="#关于启动页图片" class="headerlink" title="关于启动页图片"></a>关于启动页图片</h4><ol>
<li>图片命名为：<code>Default@2x.png</code>和<code>Default-568h@2x.png</code>放入项目</li>
<li>把[项目设置]中，<code>launch screen file</code>设置为<code>空</code>即可自动调用</li>
</ol>
<hr>
<h4 id="UIButton专题"><a href="#UIButton专题" class="headerlink" title="UIButton专题"></a>UIButton专题</h4><p>_</p>
<h5 id="各种属性设置"><a href="#各种属性设置" class="headerlink" title="各种属性设置"></a>各种属性设置</h5><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> btn = <span class="type">UIButton</span>()</div><div class="line">btn.frame = <span class="type">CGRectMake</span>(<span class="number">12</span>, <span class="number">12</span>, <span class="number">12</span>, <span class="number">12</span>)</div><div class="line"><span class="keyword">self</span>.view.addSubview(btn)</div><div class="line"></div><div class="line"><span class="comment">//这些圆角的设定也适合于UIView</span></div><div class="line">btn.layer.cornerRadius = <span class="number">4</span></div><div class="line">btn.layer.borderColor = mixiColor.mainCoffie.<span class="type">CGColor</span></div><div class="line">btn.layer.borderWidth = <span class="number">0.5</span></div><div class="line">btn.layer.masksToBounds = <span class="literal">true</span>  <span class="comment">//如果里面的子view多出来，就切掉</span></div><div class="line"></div><div class="line"><span class="comment">//文字相关</span></div><div class="line">btn.setTitle(‘title', forState: <span class="type">UIControlState</span>.<span class="type">Normal</span>)</div><div class="line">btn.titleLabel?.font = <span class="type">UIFont</span>.systemFontOfSize(<span class="number">12</span>)</div><div class="line">btn.setTitleColor(mixiColor.mainCoffie, forState: <span class="type">UIControlState</span>.<span class="type">Normal</span>)</div><div class="line">btn.setTitleColor(mixiColor.mainCoffie, forState: <span class="type">UIControlState</span>.<span class="type">Highlighted</span>)</div><div class="line">btn.setTitleColor(<span class="type">UIColor</span>.whiteColor(), forState: <span class="type">UIControlState</span>.<span class="type">Selected</span>)</div><div class="line"></div><div class="line"><span class="comment">//背景颜色</span></div><div class="line">btn.setBackgroundImage(buttonImage, forState: <span class="type">UIControlState</span>.<span class="type">Selected</span>)</div><div class="line">btn.backgroundColor = mixiColor.mainCoffie</div><div class="line"></div><div class="line"><span class="comment">//事件</span></div><div class="line">btn.addTarget(<span class="keyword">self</span>, action:<span class="type">Selector</span>(<span class="string">"distrectBtnPressed:"</span>), forControlEvents: <span class="type">UIControlEvents</span>.<span class="type">TouchUpInside</span>)</div></pre></td></tr></table></figure>
<h5 id="按钮中图片和文字的位置怎么调？"><a href="#按钮中图片和文字的位置怎么调？" class="headerlink" title="按钮中图片和文字的位置怎么调？"></a>按钮中图片和文字的位置怎么调？</h5><p>调整对齐方式：属性-&gt;Control-&gt;Alignment<br>调整padding：属性-&gt;Button栏最下面-&gt;Edge选文字还是图片-&gt;Inset<br>想图片在上文字在下：重写layoutSubviews方法。</p>
<h5 id="如何让按钮按下去的时候不变色"><a href="#如何让按钮按下去的时候不变色" class="headerlink" title="如何让按钮按下去的时候不变色"></a>如何让按钮按下去的时候不变色</h5><p><code>btn.adjustsImageWhenHighlighted = false</code></p>
<h5 id="如何让按钮不能点"><a href="#如何让按钮不能点" class="headerlink" title="如何让按钮不能点"></a>如何让按钮不能点</h5><p><code>btn.userInterractionEnabled = false</code></p>
<hr>
<h4 id="素材图片的拉伸"><a href="#素材图片的拉伸" class="headerlink" title="素材图片的拉伸"></a>素材图片的拉伸</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">extension</span> <span class="title">UIImage</span></span>&#123;</div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">func</span> <span class="title">resizabelImage</span>(#<span class="title">name</span> :<span class="title">String</span>) -&gt;<span class="title">UIImage</span>?</span>&#123;</div><div class="line">        <span class="keyword">if</span> <span class="keyword">let</span> normalImage = <span class="type">UIImage</span>(named: name)&#123;</div><div class="line">            <span class="keyword">let</span> w = <span class="type">CGFloat</span>(normalImage.size.width * <span class="number">0.5</span>)</div><div class="line">            <span class="keyword">let</span> h = <span class="type">CGFloat</span>(normalImage.size.width * <span class="number">0.5</span>)</div><div class="line">            <span class="keyword">return</span> normalImage.resizableImageWithCapInsets(<span class="type">UIEdgeInsets</span>(top: h, <span class="keyword">left</span>: w, bottom: h, <span class="keyword">right</span>: w))</div><div class="line">        &#125;<span class="keyword">else</span>&#123;</div><div class="line">            <span class="keyword">return</span> <span class="literal">nil</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<h4 id="控制键盘"><a href="#控制键盘" class="headerlink" title="控制键盘"></a>控制键盘</h4><p>_</p>
<h5 id="关闭键盘"><a href="#关闭键盘" class="headerlink" title="关闭键盘"></a>关闭键盘</h5><p><code>self.view.endEditing(true)</code></p>
<h5 id="触摸任意区域关闭键盘"><a href="#触摸任意区域关闭键盘" class="headerlink" title="触摸任意区域关闭键盘"></a>触摸任意区域关闭键盘</h5><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> tapGestureRecognizer:<span class="type">UITapGestureRecognizer</span> = <span class="type">UITapGestureRecognizer</span>(target: <span class="keyword">self</span>, action: <span class="string">"keyboardHide"</span>)</div><div class="line"></div><div class="line"><span class="comment">//为啥要加下面这行？答：不加的话里面的view的按钮会点不动。</span></div><div class="line"><span class="comment">//参考：http://blog.csdn.net/kylinbl/article/details/9139473</span></div><div class="line">tapGestureRecognizer.cancelsTouchesInView = <span class="literal">false</span>;</div><div class="line"><span class="keyword">self</span>.view.addGestureRecognizer(tapGestureRecognizer)</div></pre></td></tr></table></figure>
<h5 id="监听键盘弹出事件"><a href="#监听键盘弹出事件" class="headerlink" title="监听键盘弹出事件"></a>监听键盘弹出事件</h5><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//这里是viewDidLoad里面</span></div><div class="line"><span class="type">NSNotificationCenter</span>.defaultCenter().addObserver(<span class="keyword">self</span>, selector: <span class="type">Selector</span>(<span class="string">"keyboardWillChangeFrame"</span>), name: <span class="string">"UIKeyboardWillChangeFrameNotification"</span>, object: <span class="literal">nil</span>)</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">//这里是controller的class里面</span></div><div class="line"><span class="comment">//弹出键盘时同时向上滚动view</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">keyboardWillChangeFrame</span><span class="params">(note :NSNotification)</span></span>&#123;</div><div class="line">    <span class="keyword">var</span> shift :<span class="type">CGFloat</span> = <span class="number">0</span></div><div class="line">    <span class="keyword">let</span> userInfo = note.userInfo!</div><div class="line">    <span class="keyword">let</span> keyboardFrame = userInfo[<span class="type">UIKeyboardFrameEndUserInfoKey</span>]?.<span class="type">CGRectValue</span>()</div><div class="line">    <span class="keyword">let</span> transformY = keyboardFrame!.origin.y - <span class="keyword">self</span>.view.frame.size.height</div><div class="line">    <span class="keyword">let</span> duration = userInfo[<span class="type">UIKeyboardAnimationDurationUserInfoKey</span>] <span class="keyword">as</span>! <span class="type">Double</span></div><div class="line">    <span class="type">UIView</span>.animateWithDuration(duration, animations: &#123;</div><div class="line">        <span class="keyword">self</span>.view.transform = <span class="type">CGAffineTransformMakeTranslation</span>(<span class="number">0</span>, transformY + shift)</div><div class="line">    &#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">//这里是controller的class里面</span></div><div class="line"><span class="comment">//记得给controller写deinit，移除消息通知监听(必须)</span></div><div class="line"><span class="keyword">deinit</span> &#123;</div><div class="line">    <span class="type">NSNotificationCenter</span>.defaultCenter().removeObserver(<span class="keyword">self</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="呼出键盘"><a href="#呼出键盘" class="headerlink" title="呼出键盘"></a>呼出键盘</h5><p><code>textField对象.becomeFirstResponder()</code></p>
<hr>
<h4 id="界面跳转"><a href="#界面跳转" class="headerlink" title="界面跳转"></a>界面跳转</h4><p>在segue的prepare中不要直接去更新目标页面控件，而是把数据传给它的module，因为此时outlet还没有设置。然后在viewdidload中，用更新好的module来设置UI。</p>
<p>往回跳<br>self.navigationController?.popToRootViewControllerAnimated(true)<br>self.navigationController?.popViewControllerAnimated(true)</p>
<p>数据怎么回传？<br>前面那个controller成为后面那个的代理（搞个协议），让后面那个持有前面那个的指针，然后就可以传参数调用前面那个controller的函数了</p>
<hr>
<h4 id="UITabbarController的自定义经验"><a href="#UITabbarController的自定义经验" class="headerlink" title="UITabbarController的自定义经验"></a>UITabbarController的自定义经验</h4><ol>
<li>重写viewWillAppear()，在里面直接self.tabBar.removeFromSuperview()。</li>
<li>把自定义的tabBar放到原来tabBar的位置（直接copy它的frame）</li>
<li>对于点击事件，UITabbarController作为自定义tabbar的委托，调用<code>self.selectedIndex = 下标数字</code>即可切换子controller</li>
<li>添加子controller的方法：<code>self.addChildViewController(子controller)</code></li>
</ol>
<hr>
<h4 id="UINavigationController的配置经验"><a href="#UINavigationController的配置经验" class="headerlink" title="UINavigationController的配置经验"></a>UINavigationController的配置经验</h4><p>这个导航条蛮搞的，UINavigationController不但提供view的容器，还提供bar的容器。</p>
<h5 id="哪些是由UINavigationController管的"><a href="#哪些是由UINavigationController管的" class="headerlink" title="哪些是由UINavigationController管的"></a>哪些是由UINavigationController管的</h5><p>主要是格式类的配置，大概是希望一次性设置不用每个子controller再设置</p>
<ol>
<li>bar的<code>背景染色</code>(navi.navigationBar.<code>barTintColor</code>)</li>
<li>bar上title的<code>文字属性</code>titleTextAttributes。包括颜色、字体、阴影等。</li>
<li>bar上的<code>item染色</code>tintColor</li>
<li>bar的特性，比如<code>navi.hidesBarsOnSwipe = true</code>，向上滑动时自动收起bar</li>
</ol>
<h5 id="哪些是由子controller管的配置"><a href="#哪些是由子controller管的配置" class="headerlink" title="哪些是由子controller管的配置"></a>哪些是由子controller管的配置</h5><p>内容性的配置，主要由一个navigationItem存储这些内容。（相当于一个module）</p>
<ol>
<li>左边和右边的barItem（self.navigationItem.leftBarButtonItem）</li>
<li>bar上面的title文字内容（self.navigationItem.title）<br>「注」<code>self.navigationController</code>得到的就是上面那个UINavigationController</li>
</ol>
<h5 id="如何干掉默认的返回键文字"><a href="#如何干掉默认的返回键文字" class="headerlink" title="如何干掉默认的返回键文字"></a>如何干掉默认的返回键文字</h5><p>左上角默认会把上一个controller的title写在那里，处理起来很不方便。有一个很机智的做法：重写上一个controller的<code>viewWillAppear</code>和<code>viewWillDisappear</code>，将要出现的时候加上title，将要消失的时候就把title设置为空。这样，push到下一个controller的时候返回键那里显示就是空拉~</p>
<h5 id="如何设置barItem的位置？"><a href="#如何设置barItem的位置？" class="headerlink" title="如何设置barItem的位置？"></a>如何设置barItem的位置？</h5><p><code>self.navigationItem.leftBarButtonItem?.imageInsets = UIEdgeInsets(...)</code></p>
<h5 id="如何截获controller的pop？"><a href="#如何截获controller的pop？" class="headerlink" title="如何截获controller的pop？"></a>如何截获controller的pop？</h5><p>重写<code>popViewControllerAnimated(...)</code>方法，可以在pop前自定义操作，甚至可以指定pop至的controller。</p>
<hr>
<h4 id="UITableViewController的配置经验"><a href="#UITableViewController的配置经验" class="headerlink" title="UITableViewController的配置经验"></a>UITableViewController的配置经验</h4><p>这个contorller强制你整个view都是tableview，不能加点别的东西，比较死，一般不用。通常是在一个默认的UIViewController里面拖一个tableView进去，设置一下delegation和dataSource。</p>
<h5 id="为什么看不到cell？"><a href="#为什么看不到cell？" class="headerlink" title="为什么看不到cell？"></a>为什么看不到cell？</h5><p>记得写这俩函数：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">numberOfSectionsInTableView</span><span class="params">(...)</span></span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="number">1</span>            <span class="comment">//返回table的组数</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">tableView</span><span class="params">(..., numberOfRowsInSection ...)</span></span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="number">10</span>           <span class="comment">//返回table的行数，告诉controller每组一共几行</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">tableView</span><span class="params">(..., cellForRowAtIndexPath ...)</span></span>&#123;</div><div class="line">    <span class="keyword">let</span> cell = tableView.dequeueReusableCellWithIdentifier(<span class="string">"DaRenCell"</span>, forIndexPath: indexPath) <span class="keyword">as</span>! <span class="type">DaRenTableViewCell</span>    <span class="comment">//DaRenCell是Prototype cell的id</span></div><div class="line">    <span class="keyword">return</span> cell         <span class="comment">//返回一个cell对象，告诉controller每一行显示啥</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h5 id="自动调整的row-height"><a href="#自动调整的row-height" class="headerlink" title="自动调整的row height"></a>自动调整的row height</h5><p>如果cell里面的控件全都使用autoLayout，则可以让系统自己自动调整行高。在controller中做一下配置即可：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">tableView.estimatedRowHeight = tableView.rowHeight</div><div class="line">tableView.rowHeight = <span class="type">UITableViewAutomaticDimension</span></div></pre></td></tr></table></figure></p>
<h5 id="数据重载"><a href="#数据重载" class="headerlink" title="数据重载"></a>数据重载</h5><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//重载整个table</span></div><div class="line"><span class="keyword">self</span>.tableView.reloadData()</div><div class="line"><span class="comment">//重载单个cell并带动画</span></div><div class="line"><span class="keyword">self</span>.tableView.reloadRowsAtIndexPaths([<span class="type">NSIndexPath</span>(forRow: rowNmuber, inSection: <span class="number">0</span>)] , withRowAnimation: <span class="type">UITableViewRowAnimation</span>.<span class="type">Automatic</span>)</div></pre></td></tr></table></figure>
<h5 id="滚动到指定的位置"><a href="#滚动到指定的位置" class="headerlink" title="滚动到指定的位置"></a>滚动到指定的位置</h5><p>没仔细研究，总觉的这个方法有时有行有时候不行：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">self</span>.tableView.scrollToRowAtIndexPath(<span class="type">NSIndexPath</span>(forRow: <span class="keyword">self</span>.chatData.data.<span class="built_in">count</span>-<span class="number">1</span>, inSection: <span class="number">0</span>), atScrollPosition: <span class="type">UITableViewScrollPosition</span>.<span class="type">Bottom</span>, animated: <span class="literal">true</span>)</div></pre></td></tr></table></figure></p>
<h5 id="滚动的检测"><a href="#滚动的检测" class="headerlink" title="滚动的检测"></a>滚动的检测</h5><p>tableView继承自scrollView，所以会调用<code>scrollViewDidScroll()</code>方法</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//这段让上面的bar在tableview向上滚动时自动收起来</span></div><div class="line"><span class="meta">@IBOutlet</span> <span class="keyword">weak</span> <span class="keyword">var</span> mainSearchBar: <span class="type">UIView</span>!</div><div class="line"><span class="keyword">var</span> lastOffSet :<span class="type">CGFloat</span> = <span class="number">0</span></div><div class="line"><span class="keyword">var</span> accumulate :<span class="type">CGFloat</span> = <span class="number">0</span>  <span class="comment">//累计判断正负，以防变化太快</span></div><div class="line"></div><div class="line"><span class="comment">//监听tableview的滑动</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">scrollViewDidScroll</span><span class="params">(scrollView: UIScrollView)</span></span> &#123;</div><div class="line">    accumulate += scrollView.contentOffset.y - lastOffSet   <span class="comment">//累计混动的距离，向上增加，向下减少</span></div><div class="line">    <span class="keyword">if</span>(accumulate &gt; <span class="number">150</span>)&#123;           <span class="comment">//150的阈值比较合适</span></div><div class="line">        accumulate = <span class="number">0</span></div><div class="line">        <span class="comment">//这里代码让bar向上滑动，以隐藏</span></div><div class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(accumulate &lt; -<span class="number">10</span>)&#123;      <span class="comment">//恢复的阈值设置的较低</span></div><div class="line">        accumulate = <span class="number">0</span></div><div class="line">        <span class="comment">//这里代码让bar恢复</span></div><div class="line">    &#125;</div><div class="line">    lastOffSet = scrollView.contentOffset.y</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<h4 id="动画"><a href="#动画" class="headerlink" title="动画"></a>动画</h4><p>动画有两个比较常用，一个带结束后步骤，一个不带。<br>「注意」同一个线程里，虽然你可以不等前面那个结束就开始下一个动画，但并不会并发。<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="type">UIView</span>.animateWithDuration(<span class="number">0.1</span>, animations: &#123;[<span class="keyword">unowned</span> <span class="keyword">self</span>] <span class="keyword">in</span></div><div class="line"><span class="keyword">self</span>.bookDateView.alpha = <span class="number">0</span>     <span class="comment">//满满变透明</span></div><div class="line">&#125;, completion: &#123;</div><div class="line"><span class="keyword">if</span> $<span class="number">0</span>&#123;      <span class="comment">//这个$0是匿名函数必须的，代表动画是否成功</span></div><div class="line"><span class="type">MBProgressHUD</span>.showHUDAddedTo(<span class="keyword">self</span>.view, animated: <span class="literal">true</span>)</div><div class="line">&#125;</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="comment">//这个简单版本不带completion</span></div><div class="line"><span class="type">UIView</span>.animateWithDuration(<span class="number">0.3</span>, animations: &#123;[<span class="keyword">unowned</span> <span class="keyword">self</span>] <span class="keyword">in</span></div><div class="line"><span class="keyword">self</span>.bookSucceedView.alpha = <span class="number">1</span></div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="comment">//注意这里[unowned self] 意思是闭包中不要捕获self，以防循环引用</span></div></pre></td></tr></table></figure></p>
<hr>
<h4 id="多线程"><a href="#多线程" class="headerlink" title="多线程"></a>多线程</h4><p>并没有深入研究，保存了一点有用的代码：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> qos = <span class="type">Int</span>( <span class="type">QOS_CLASS_USER_INTERACTIVE</span>.value)</div><div class="line"><span class="keyword">let</span> queue = dispatch_get_global_queue(qos, <span class="number">0</span>)</div><div class="line">dispatch_async(queue) &#123;</div><div class="line">    sleep(<span class="number">2</span>)</div><div class="line">    <span class="comment">//do something</span></div><div class="line">    dispatch_async(dispatch_get_main_queue()) &#123;   <span class="comment">//UI相关的动作必须切换到主线程</span></div><div class="line">        <span class="keyword">self</span>.tableView.reloadData()</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<hr>
<h4 id="折纸效果的侧滑栏实现"><a href="#折纸效果的侧滑栏实现" class="headerlink" title="折纸效果的侧滑栏实现"></a>折纸效果的侧滑栏实现</h4><p>滑动时侧边栏跟着移动并带渐变阴影，滑动时根据力度决定是否划开。<br>这段代码我记得写了整整一天，调了无数bug，做到了较好的体验。<br>并没有办法重现当时的神勇，直接保留代码。。。<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">//  SlideViewController.swift</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">//  Created by LuRock on 15/3/22.</span></div><div class="line"><span class="comment">//  Copyright (c) 2015年 LuRock. All rights reserved.</span></div><div class="line"><span class="comment">//</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> UIKit</div><div class="line"></div><div class="line"><span class="comment">//侧滑栏的宽度比例</span></div><div class="line"><span class="keyword">let</span> <span class="type">SLIDERATE</span> :<span class="type">CGFloat</span> = <span class="number">0.6</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">leftBarButtunDelegate</span> :<span class="title">class</span></span>&#123;      <span class="comment">//class关键字可以让这个协议使用weak指针，原因待查</span></div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">leftBarButtunClicked</span><span class="params">()</span></span></div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">SlideViewController</span>: <span class="title">UIViewController</span>, <span class="title">leftBarButtunDelegate</span>, <span class="title">SlideBarViewDelegate</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">var</span> slideBar :<span class="type">SlideBarViewController</span>!</div><div class="line"></div><div class="line">    <span class="comment">//存放所有可以被侧滑拦切换出来的viewcontroller。字典，key是view的名字，如“个人中心”</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">var</span> mainviewController = [<span class="type">String</span>:<span class="type">UIViewController</span>]()</div><div class="line">    <span class="comment">//标记活动的controller</span></div><div class="line">    <span class="keyword">var</span> activeMainViewControler :<span class="type">UIViewController</span>!</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">//用来记录侧滑手势的上一个偏移值</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">var</span> lastX :<span class="type">CGFloat</span> = <span class="number">0</span></div><div class="line"></div><div class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">super</span>.viewDidLoad()</div><div class="line"></div><div class="line">        <span class="comment">//这里从storyboard读取并实例化侧边栏</span></div><div class="line">        <span class="keyword">let</span> storyboard = <span class="type">UIStoryboard</span>(name: <span class="string">"Main"</span>, bundle: <span class="literal">nil</span>)</div><div class="line">        <span class="keyword">self</span>.slideBar = storyboard.instantiateViewControllerWithIdentifier(<span class="string">"SlideBar"</span>) <span class="keyword">as</span>! <span class="type">SlideBarViewController</span></div><div class="line">        <span class="keyword">self</span>.slideBar.delegate = <span class="keyword">self</span></div><div class="line"></div><div class="line">        <span class="comment">//设置侧边栏的frame</span></div><div class="line">        <span class="keyword">self</span>.slideBar.view.frame = <span class="type">CGRect</span>(x: -<span class="keyword">self</span>.view.frame.width * <span class="type">SLIDERATE</span> * <span class="number">0.25</span>, y: <span class="number">0</span>, width: <span class="keyword">self</span>.view.frame.width * <span class="type">SLIDERATE</span>, height: <span class="keyword">self</span>.view.frame.height)</div><div class="line"></div><div class="line">        <span class="comment">//先加到数组里面的view会在下面</span></div><div class="line">        <span class="keyword">self</span>.addChildViewController(slideBar)</div><div class="line">        <span class="keyword">self</span>.view.addSubview(slideBar.view)</div><div class="line">        <span class="keyword">self</span>.view.sendSubviewToBack(slideBar.view)   <span class="comment">//这句可以把某个view弄到最底下</span></div><div class="line"></div><div class="line">        <span class="comment">//实例化子controller，设置它们的delegation，放置到mainviewController字典里</span></div><div class="line">        setUpMainViewController()</div><div class="line"></div><div class="line">    &#125;<span class="comment">//viewDidLoad</span></div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">//这是个proxy，是为了统一化侧滑栏的阴影和移动</span></div><div class="line">    <span class="keyword">var</span> slideBarTransform :<span class="type">CGAffineTransform</span> = <span class="type">CGAffineTransformIdentity</span>&#123;</div><div class="line">        <span class="keyword">didSet</span>&#123;</div><div class="line">            <span class="keyword">self</span>.slideBar.view.transform = slideBarTransform</div><div class="line">            <span class="keyword">self</span>.slideBar.shadow.alpha = <span class="number">1</span> - slideBarTransform.tx / (<span class="keyword">self</span>.slideBar.view.frame.width * <span class="type">SLIDERATE</span> * <span class="number">0.5</span>)</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">//translation不是翻译的意思，意思是“移动量”</span></div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">didDrag</span><span class="params">(pan:UIPanGestureRecognizer)</span></span>&#123;</div><div class="line"></div><div class="line">        <span class="keyword">let</span> point = pan.translationInView(pan.view!)</div><div class="line">        <span class="keyword">let</span> slideBarWidth = <span class="keyword">self</span>.slideBar.view.frame.width</div><div class="line">        <span class="keyword">let</span> duration = <span class="number">0.25</span></div><div class="line">        <span class="keyword">if</span> <span class="keyword">let</span> viewFrameMinX = pan.view?.frame.minX&#123;</div><div class="line">            <span class="keyword">if</span> (pan.state == <span class="type">UIGestureRecognizerState</span>.<span class="type">Changed</span>)&#123;</div><div class="line">                <span class="comment">//这里记录上次的位置，以确定拖拽方向</span></div><div class="line">                <span class="keyword">self</span>.lastX = viewFrameMinX</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="comment">// 结束拖拽</span></div><div class="line">            <span class="keyword">if</span> (pan.state == <span class="type">UIGestureRecognizerState</span>.<span class="type">Cancelled</span> || pan.state == <span class="type">UIGestureRecognizerState</span>.<span class="type">Ended</span>) &#123;</div><div class="line">                <span class="keyword">if</span>(viewFrameMinX &gt; <span class="keyword">self</span>.lastX)&#123; <span class="comment">//如果向右拖</span></div><div class="line">                    <span class="keyword">if</span> (viewFrameMinX &gt;= slideBarWidth * <span class="number">0.2</span>) &#123; <span class="comment">// 往右边至少走动了五分之一</span></div><div class="line">                        <span class="type">UIView</span>.animateWithDuration(duration, animations: &#123;</div><div class="line">                            pan.view!.transform = <span class="type">CGAffineTransformMakeTranslation</span>(slideBarWidth, <span class="number">0</span>)</div><div class="line">                            <span class="keyword">self</span>.slideBarTransform = <span class="type">CGAffineTransformMakeTranslation</span>(slideBarWidth * <span class="type">SLIDERATE</span> * <span class="number">0.5</span>, <span class="number">0</span>)</div><div class="line"></div><div class="line">                        &#125;)</div><div class="line"></div><div class="line">                    &#125; <span class="keyword">else</span>&#123; <span class="comment">// 走动距离的没有达到四分之一</span></div><div class="line">                        <span class="type">UIView</span>.animateWithDuration(duration, animations: &#123;</div><div class="line">                            pan.view!.transform = <span class="type">CGAffineTransformIdentity</span>   <span class="comment">//这个参数需要理解，能复原位置</span></div><div class="line">                            <span class="keyword">self</span>.slideBarTransform = <span class="type">CGAffineTransformIdentity</span></div><div class="line"></div><div class="line">                        &#125;)</div><div class="line">                    &#125;</div><div class="line">                &#125;<span class="keyword">else</span>&#123;</div><div class="line">                    <span class="keyword">if</span> (viewFrameMinX &lt;= slideBarWidth * <span class="number">0.8</span>) &#123; <span class="comment">// 往左边至少走动了五分之一</span></div><div class="line">                        <span class="type">UIView</span>.animateWithDuration(duration, animations: &#123;</div><div class="line">                            pan.view!.transform = <span class="type">CGAffineTransformIdentity</span></div><div class="line">                            <span class="keyword">self</span>.slideBarTransform = <span class="type">CGAffineTransformIdentity</span></div><div class="line">                        &#125;)</div><div class="line"></div><div class="line">                    &#125; <span class="keyword">else</span>&#123;</div><div class="line">                        <span class="type">UIView</span>.animateWithDuration(duration, animations: &#123;</div><div class="line">                            pan.view!.transform = <span class="type">CGAffineTransformMakeTranslation</span>(slideBarWidth, <span class="number">0</span>)</div><div class="line">                            <span class="keyword">self</span>.slideBarTransform = <span class="type">CGAffineTransformMakeTranslation</span>(slideBarWidth * <span class="type">SLIDERATE</span> * <span class="number">0.5</span>, <span class="number">0</span>)</div><div class="line"></div><div class="line">                        &#125;)</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125; <span class="keyword">else</span> &#123; <span class="comment">// begin和changed都会进来</span></div><div class="line">                pan.view!.transform = <span class="type">CGAffineTransformTranslate</span>(pan.view!.transform, point.x, <span class="number">0</span>)</div><div class="line">                slideBarTransform = <span class="type">CGAffineTransformTranslate</span>(<span class="keyword">self</span>.slideBar.view.transform, point.x * <span class="type">SLIDERATE</span> * <span class="number">0.5</span>, <span class="number">0</span>)</div><div class="line">                pan.setTranslation(<span class="type">CGPointZero</span>, inView: pan.view!)</div><div class="line">                <span class="keyword">if</span> (pan.view!.frame.minX &gt;= slideBarWidth) &#123;</div><div class="line">                    pan.view!.transform = <span class="type">CGAffineTransformMakeTranslation</span>(slideBarWidth, <span class="number">0</span>)</div><div class="line">                    slideBarTransform = <span class="type">CGAffineTransformMakeTranslation</span>(slideBarWidth * <span class="type">SLIDERATE</span> * <span class="number">0.5</span>, <span class="number">0</span>)</div><div class="line"></div><div class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (pan.view!.frame.minX &lt;= <span class="number">0</span>) &#123;</div><div class="line">                    pan.view!.transform = <span class="type">CGAffineTransformIdentity</span></div><div class="line">                    slideBarTransform = <span class="type">CGAffineTransformIdentity</span></div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">//代理方法，监听左上角点击</span></div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">leftBarButtunClicked</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">self</span>.view.endEditing(<span class="literal">true</span>)</div><div class="line">        <span class="keyword">if</span>(<span class="keyword">self</span>.activeMainViewControler.view.frame.minX == <span class="number">0</span>)&#123;</div><div class="line">            <span class="type">UIView</span>.animateWithDuration(<span class="number">0.4</span>, animations: &#123;</div><div class="line">                <span class="keyword">self</span>.activeMainViewControler.view.transform = <span class="type">CGAffineTransformMakeTranslation</span>(<span class="keyword">self</span>.slideBar.view.frame.width, <span class="number">0</span>)</div><div class="line">                <span class="keyword">self</span>.slideBarTransform = <span class="type">CGAffineTransformMakeTranslation</span>(<span class="keyword">self</span>.slideBar.view.frame.width * <span class="type">SLIDERATE</span> * <span class="number">0.5</span>, <span class="number">0</span>)</div><div class="line"></div><div class="line">            &#125;)</div><div class="line">        &#125;<span class="keyword">else</span>&#123;</div><div class="line">            <span class="type">UIView</span>.animateWithDuration(<span class="number">0.4</span>, animations: &#123;</div><div class="line">                <span class="keyword">self</span>.activeMainViewControler.view.transform = <span class="type">CGAffineTransformIdentity</span></div><div class="line">                <span class="keyword">self</span>.slideBarTransform = <span class="type">CGAffineTransformIdentity</span></div><div class="line">            &#125;)</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//代理方法，监听左边bar的点击，切换主view</span></div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">changeMainViewToTarget</span><span class="params">(targetView: String?)</span></span> &#123;</div><div class="line"></div><div class="line">        <span class="keyword">let</span> gesture = <span class="type">UIPanGestureRecognizer</span>(target: <span class="keyword">self</span>, action: <span class="type">Selector</span>(<span class="string">"didDrag:"</span>))</div><div class="line"></div><div class="line">        <span class="keyword">if</span> <span class="keyword">let</span> acticeView = <span class="keyword">self</span>.activeMainViewControler?.view&#123;   <span class="comment">//有旧view</span></div><div class="line"></div><div class="line">            <span class="comment">//如果点击已经活动的view，那就不要切换了</span></div><div class="line">            <span class="keyword">if</span> <span class="keyword">self</span>.activeMainViewControler! == mainviewController[targetView!]!&#123;</div><div class="line">                <span class="keyword">return</span></div><div class="line">            &#125;</div><div class="line"></div><div class="line">            leftBarButtunClicked()</div><div class="line"></div><div class="line">            <span class="comment">//记录目前view的位置，等下交给新view</span></div><div class="line">            <span class="comment">//          let originTransform = acticeView.frame   //如果这里用frame，则后面手势计算transform的时候会有严重bug</span></div><div class="line">            <span class="keyword">let</span> originTransform = acticeView.transform</div><div class="line"></div><div class="line">            <span class="type">UIView</span>.animateWithDuration(<span class="number">0.4</span>, animations: &#123; [<span class="keyword">unowned</span> <span class="keyword">self</span>] <span class="keyword">in</span></div><div class="line">                acticeView.transform = <span class="type">CGAffineTransformMakeTranslation</span>(<span class="keyword">self</span>.view.frame.width, <span class="number">0</span>)</div><div class="line">                &#125;, completion: &#123;</div><div class="line">                    <span class="keyword">if</span> $<span class="number">0</span>&#123;</div><div class="line">                        <span class="comment">//重要问题：手势识别器不能同时被多个view注册，否则只认最后一个view的手势</span></div><div class="line">                        <span class="comment">//解除手势</span></div><div class="line">                        acticeView.removeGestureRecognizer(gesture)</div><div class="line">                        <span class="comment">//去除view</span></div><div class="line">                        acticeView.removeFromSuperview()</div><div class="line">                    &#125;</div><div class="line">            &#125;)</div><div class="line">            <span class="comment">//这里开始加新view</span></div><div class="line">            <span class="keyword">if</span> <span class="keyword">let</span> target = targetView&#123;</div><div class="line">                <span class="keyword">if</span> <span class="keyword">let</span> targetController = mainviewController[target]&#123;</div><div class="line">                    <span class="keyword">self</span>.view.addSubview(targetController.view)</div><div class="line"></div><div class="line">                    <span class="comment">//加入手势</span></div><div class="line">                    targetController.view.addGestureRecognizer(gesture)</div><div class="line">                    <span class="comment">//一开始从最右边出现</span></div><div class="line">                    targetController.view.transform = <span class="type">CGAffineTransformMakeTranslation</span>(<span class="keyword">self</span>.view.frame.width, <span class="number">0</span>)</div><div class="line">                    <span class="comment">//然后移到原来的位置</span></div><div class="line">                    <span class="type">UIView</span>.animateWithDuration(<span class="number">0.4</span>, animations: &#123; [<span class="keyword">unowned</span> <span class="keyword">self</span>] <span class="keyword">in</span></div><div class="line">                        targetController.view.transform = originTransform</div><div class="line">                        &#125;)</div><div class="line"></div><div class="line">                    <span class="keyword">self</span>.activeMainViewControler = targetController</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            <span class="comment">//没有旧view，就是第一次启动</span></div><div class="line">        &#125;<span class="keyword">else</span>&#123;</div><div class="line">            <span class="keyword">if</span> <span class="keyword">let</span> target = targetView&#123;</div><div class="line">                <span class="keyword">if</span> <span class="keyword">let</span> targetController = mainviewController[target]&#123;</div><div class="line">                    <span class="keyword">self</span>.view.addSubview(targetController.view)</div><div class="line">                    <span class="comment">//加入手势</span></div><div class="line">                    targetController.view.addGestureRecognizer(gesture)</div><div class="line">                    <span class="keyword">self</span>.activeMainViewControler = targetController</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//4月20日新增，侧滑栏底下碰到可以收回去，体验更友好</span></div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">gestureBtnclicked</span><span class="params">()</span></span>&#123;</div><div class="line">        leftBarButtunClicked()</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">//可以改进的地方：并未检测用户滑动速度</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<hr>
<h4 id="手机号码的鉴定"><a href="#手机号码的鉴定" class="headerlink" title="手机号码的鉴定"></a>手机号码的鉴定</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">isTelNumber</span><span class="params">(num:String)</span></span>-&gt;<span class="type">Bool</span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">var</span> mobile = <span class="string">"^1(3[0-9]|5[0-35-9]|8[025-9])\\d&#123;8&#125;$"</span></div><div class="line">    <span class="keyword">var</span>  <span class="type">CM</span> = <span class="string">"^1(34[0-8]|(3[5-9]|5[017-9]|8[278])\\d)\\d&#123;7&#125;$"</span></div><div class="line">    <span class="keyword">var</span>  <span class="type">CU</span> = <span class="string">"^1(3[0-2]|5[256]|8[56])\\d&#123;8&#125;$"</span></div><div class="line">    <span class="keyword">var</span>  <span class="type">CT</span> = <span class="string">"^1((33|53|8[09])[0-9]|349)\\d&#123;7&#125;$"</span></div><div class="line">    <span class="keyword">var</span> regextestmobile = <span class="type">NSPredicate</span>(format: <span class="string">"SELF MATCHES %@"</span>,mobile)</div><div class="line">    <span class="keyword">var</span> regextestcm = <span class="type">NSPredicate</span>(format: <span class="string">"SELF MATCHES %@"</span>,<span class="type">CM</span> )</div><div class="line">    <span class="keyword">var</span> regextestcu = <span class="type">NSPredicate</span>(format: <span class="string">"SELF MATCHES %@"</span> ,<span class="type">CU</span>)</div><div class="line">    <span class="keyword">var</span> regextestct = <span class="type">NSPredicate</span>(format: <span class="string">"SELF MATCHES %@"</span> ,<span class="type">CT</span>)</div><div class="line">    <span class="keyword">if</span> ((regextestmobile.evaluateWithObject(num) == <span class="literal">true</span>)</div><div class="line">        || (regextestcm.evaluateWithObject(num)  == <span class="literal">true</span>)</div><div class="line">        || (regextestct.evaluateWithObject(num) == <span class="literal">true</span>)</div><div class="line">        || (regextestcu.evaluateWithObject(num) == <span class="literal">true</span>))</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> <span class="literal">true</span></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> <span class="literal">false</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<h4 id="遗留的问题"><a href="#遗留的问题" class="headerlink" title="遗留的问题"></a>遗留的问题</h4><p>在viewdidload里面实例化另一个controller，然后把这个controller里面的一个IBoutlet的view加到主controller的view里面，此时这个子controller的所有IBoutlet都是nil。然而把这个子controller直接的view直接加到主view里面却没问题，操蛋！</p>
<p> // MARK: - Table view data source<br>insertSubview 和 addSubview 的区别？<br>tableview里面的定位，图片怎么缩小恢复到那个位置</p>
<p>self.addChildViewController(mainPageViewController)  //这个好像只有在tabbarController里面有用？self.selectedIndex = index可以切换到相应的childView</p>
<p>//这个可以把主view编程scrollview？<br>    override func loadView() {<br>        super.loadView()<br>        var scrollView:UIScrollView = UIScrollView(frame:super.view.frame)<br>        self.view = scrollView<br>    }</p>
</div></article></div></section><footer><div class="paginator"><a href="/2015/07/09/JS_CheatSheet/" class="prev">上一篇</a><a href="/2015/05/16/鼠须管配置指南/" class="next">下一篇</a></div><div class="copyright"><p>© 2015 - 2017 <a href="http://Rocklu.me">Rock Lu</a>, unless otherwise noted.</p></div></footer><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script></body></html>